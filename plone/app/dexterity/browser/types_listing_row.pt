<tal:block define="
             tups view/getCombinedWidgets;
             portal context/@@plone_portal_state/portal;
             layout portal/@@plone_layout;
             niceTitles view/getNiceTitles;
           "
           repeat="tup tups"
>

  <td tal:define="
        error python:tup[0].error;
        idx repeat/tup/index;
        normalize nocall: context/@@plone/normalizeString;
      "
      tal:attributes="
        class python:'field' + (error and ' error' or '') + (tup[0].__name__ == 'view_item_count' and ' count' or '');
      "
  >
    <tal:block repeat="widget tup">



      <a href=""
         tal:define="
           link python:view.context.context.link(view.getContent(), widget.field.__name__);
           item_type_class python:'contenttype-' + normalize(view.getContent().id);
         "
         tal:omit-tag="python:widget.mode == 'input' or link is None"
         tal:attributes="
           href link;
           class string:$item_type_class;
         "
      >

        <span class="error"
              tal:omit-tag="not:error"
        >
          <div tal:condition="error"
               tal:replace="structure error/render"
          ></div>
          <input type="text"
                 tal:replace="structure widget/render"
          />
        </span>

      </a>
    </tal:block>

  </td>
</tal:block>
